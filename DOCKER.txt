DOCKER

NÃ³ lá»«a container lÃ  nÃ³ cÃ³ há»‡ Ä‘iá»u hÃ nh riÃªng nhÆ°ng tháº­t ra chá»‰ lÃ  láº¥y há»‡ Ä‘iá»u hÃ nh cá»§a local server thÃ´i. VM má»›i tháº­t sá»± lÃ  cÃ³ OS riÃªng. 

ğŸ”¹ 1. Docker â€œÄƒn kÃ©â€ trá»±c tiáº¿p Linux kernel

Container khÃ´ng áº£o hÃ³a nguyÃªn OS mÃ  chá»‰ áº£o hÃ³a á»Ÿ má»©c kernel (OS-level virtualization).

Linux cÃ³ sáºµn:
Namespaces â†’ tÃ¡ch biá»‡t process, network, filesystem.
cgroups â†’ giá»›i háº¡n CPU, RAM, I/O.
Docker chá»‰ lÃ  lá»›p quáº£n lÃ½ + CLI Ä‘á»ƒ dÃ¹ng cÃ¡c feature nÃ y.
ğŸ‘‰ VÃ¬ váº­y trÃªn Linux, khi cháº¡y container, process cá»§a container = process bÃ¬nh thÆ°á»ng cá»§a Linux, khÃ´ng cáº§n thÃªm lá»›p trung gian.
â± Káº¿t quáº£: cháº¡y cá»±c nhanh, overhead gáº§n nhÆ° báº±ng 0.


2. TrÃªn Windows & macOS thÃ¬ khÃ¡c

Windows & macOS khÃ´ng cÃ³ Linux kernel.
Docker láº¡i cáº§n Linux kernel Ä‘á»ƒ dÃ¹ng namespaces + cgroups.

Giáº£i phÃ¡p: Docker Desktop pháº£i cháº¡y 1 Linux VM áº©n bÃªn dÆ°á»›i (dÃ¹ng Hyper-V, WSL2 trÃªn Windows, hoáº·c HyperKit trÃªn macOS).

Container thá»±c cháº¥t cháº¡y bÃªn trong VM nÃ y â†’ nÃªn:

Tá»‘n RAM/CPU hÆ¡n.
Khá»Ÿi Ä‘á»™ng cháº­m hÆ¡n.
I/O (disk, network) bá»‹ cháº­m do qua nhiá»u lá»›p.

---------------------------------------------------
Docker Desktop khÃ´ng chá»‰ lÃ  â€œDockerâ€ Ä‘Æ¡n thuáº§n, mÃ  lÃ  má»™t bá»™ cÃ´ng cá»¥ trá»n gÃ³i Ä‘á»ƒ cháº¡y container trÃªn Windows/Mac (vÃ¬ báº£n thÃ¢n 2 há»‡ nÃ y khÃ´ng cÃ³ Linux kernel).
---------------------------------------------------

ğŸ–¼ Docker Image = 1 file (báº£n máº«u)

NÃ³ thá»±c sá»± lÃ  1 file snapshot (nhiá»u layer xáº¿p chá»“ng) chá»©a toÃ n bá»™ nhá»¯ng gÃ¬ cáº§n Ä‘á»ƒ cháº¡y app: code, lib, configâ€¦

VÃ¬ váº­y khi báº¡n táº£i image vá» (docker pull), nÃ³ giá»‘ng nhÆ° táº£i 1 file nÃ©n (.zip, .iso).

ğŸ’» Docker Container = â€œmÃ¡y tÃ­nh thu nhá»â€ cháº¡y tá»« file Ä‘Ã³

Khi báº¡n docker run image_name â†’ Docker sáº½ giáº£i nÃ©n image + thÃªm 1 layer read/write bÃªn trÃªn â†’ rá»“i cháº¡y nÃ³ nhÆ° 1 mÃ¡y tÃ­nh mini (nhÆ°ng nháº¹ hÆ¡n VM ráº¥t nhiá»u).

Container cháº¡y trÃªn kernel cá»§a host (Linux kernel trong trÆ°á»ng há»£p Docker Engine).

VÃ¬ váº­y container khÃ´ng â€œáº£o hÃ³a cáº£ mÃ¡yâ€ nhÆ° VM, mÃ  chá»‰ tÃ¡ch biá»‡t tiáº¿n trÃ¬nh (process isolation).

Khi báº¡n cháº¡y má»™t image (docker run <image>) thÃ¬ Docker sáº½ táº¡o ra container tá»« image Ä‘Ã³.
---------------------------------------------------
Má»™t container chá»‰ Ä‘Æ°á»£c táº¡o ra tá»« Ä‘Ãºng má»™t image.

VÃ¬ sao váº­y?

Container lÃ  instance cá»§a image â†’ tá»©c lÃ  nÃ³ pháº£i cÃ³ â€œgá»‘câ€ rÃµ rÃ ng Ä‘á»ƒ build root filesystem.

Khi báº¡n docker run ubuntu:20.04 â†’ Docker copy filesystem tá»« image ubuntu:20.04 rá»“i thÃªm 1 layer read/write bÃªn trÃªn â†’ thÃ nh container.

Náº¿u container Ä‘Æ°á»£c táº¡o tá»« nhiá»u image thÃ¬ Docker sáº½ khÃ´ng biáº¿t â€œroot filesystemâ€ láº¥y á»Ÿ Ä‘Ã¢u.

-----------------------------------------------------
ğŸ—‚ Docker Registry

LÃ  kho lÆ°u trá»¯ image (giá»‘ng nhÆ° â€œgit repoâ€ nhÆ°ng dÃ nh cho image).

Registry cÃ³ thá»ƒ lÃ :

Public (ai cÅ©ng dÃ¹ng) â†’ Docker Hub

Private (ná»™i bá»™ cÃ´ng ty) â†’ vÃ­ dá»¥: Harbor, GitLab Container Registry, AWS ECR, GCP Artifact Registryâ€¦

Má»™t registry cÃ³ thá»ƒ chá»©a nhiá»u repository, trong repository cÃ³ nhiá»u image tag.

Docker Registry = khÃ¡i niá»‡m chung â†’ kho chá»©a image.
Docker Hub = má»™t registry cá»¥ thá»ƒ, máº·c Ä‘á»‹nh cá»§a Docker, giá»‘ng nhÆ° â€œGithub dÃ nh cho Docker Imageâ€.

===============================================
ğŸ“„ Dockerfile

LÃ  file hÆ°á»›ng dáº«n Ä‘á»ƒ build ra 1 image.
Báº¡n mÃ´ táº£: base image, copy code, cÃ i lib, lá»‡nh cháº¡y appâ€¦

Docker build -t <name> <nÆ¡i lÆ°u trá»¯ docker> 

FROM <image>
RUN <command> cháº¡y cÃ¡i lá»‡nh nÃ y á»Ÿ trong container 
WORKDIR <directory> táº¡o thÆ° má»¥c trong images
COPY <src> <dest> copy thÆ° má»¥c gá»‘c vÃ o thÆ° má»¥c cá»§a images
ADD <src/url> <dest> tÆ°Æ¡ng tá»± copy nhÆ°ng cÃ³ thá»ƒ táº£i file trÃªn máº¡ng vá» 
EXPOSE <PORT> Xuáº¥t ra port nÃ o 
CMD ["","",..] thá»±c thi cuá»‘i cÃ¹ng 


1. CÆ¡ cháº¿ hoáº¡t Ä‘á»™ng cá»§a Dockerfile vÃ  Image Layer
Khi báº¡n viáº¿t Dockerfile, Docker sáº½ build image theo tá»«ng lá»‡nh (FROM, RUN, COPY, ADD, â€¦).
Má»—i lá»‡nh â†’ táº¡o ra 1 layer má»›i trong image.
CÃ¡c layer Ä‘Æ°á»£c xáº¿p chá»“ng (union filesystem) vÃ  chá»‰ Ä‘á»c (read-only).
Container cháº¡y â†’ Docker thÃªm 1 layer read/write lÃªn trÃªn cÃ¹ng Ä‘á»ƒ ghi dá»¯ liá»‡u táº¡m.

ğŸ‘‰ VÃ¬ váº­y:
Náº¿u layer nÃ o khÃ´ng thay Ä‘á»•i â†’ Docker sáº½ cache láº¡i, khÃ´ng build láº¡i.
Layer nÃ o thay Ä‘á»•i â†’ táº¥t cáº£ cÃ¡c layer sau Ä‘Ã³ sáº½ bá»‹ build láº¡i.

CÆ¡ cháº¿: Má»—i layer lÃ  1 images nÃ³ build thÃ¬ nÃ³ cháº¡y tá»«ng layer copy vÃ o layer sau rá»“i xÃ³a luÃ´n trong lÃºc build. cuá»‘i cÃ¹ng chá»‰ giá»¯ láº¡i cÃ¡i layer cuá»‘i cÃ¹ng cÃ³ táº¥t cáº£ dá»¯ liá»‡u cá»§a layer trÆ°á»›c Ä‘Ã³ 

Tá»‘i Æ°u báº±ng layer nghÄ©a lÃ :
Sáº¯p xáº¿p lá»‡nh há»£p lÃ½ Ä‘á»ƒ táº­n dá»¥ng cache.
Gá»™p lá»‡nh Ä‘á»ƒ giáº£m layer.
DÃ¹ng base image nhá» + dá»n rÃ¡c trong cÃ¹ng layer.
DÃ¹ng multi-stage build Ä‘á»ƒ giáº£m kÃ­ch thÆ°á»›c image.
--------------------------------------------------------
âš™ï¸ Docker Compose

LÃ  cÃ´ng cá»¥ giÃºp cháº¡y nhiá»u container cÃ¹ng lÃºc, Ä‘á»‹nh nghÄ©a trong file docker-compose.yml.
Báº¡n mÃ´ táº£ cÃ¡c service (web, db, cacheâ€¦), network, volumeâ€¦
Viáº¿t báº±ng file yaml
Version: '' Version cá»§a docker enigeer 
servics: chá»©a cÃ¡c images cáº§n cháº¡y 
	pg: Ä‘Ã¢y lÃ  láº¥y á»Ÿ trÃªn register
		image: postgres:9.6-alpine
		ports:
			-5432:5432
	frontend: Ä‘Ã¢y lÃ  images tá»± build 
		image: tÃªn image 
		build:
			context: . //nÆ¡i chá»©a file dockerfile

docker-compose up (cháº¡y háº¿t images bÃªn trong)


Dockerfile = cÃ´ng thá»©c náº¥u Äƒn â†’ cho ra má»™t â€œmÃ³n Äƒnâ€ (image).
Docker Compose = thá»±c Ä‘Æ¡n + cÃ¡ch bÃ y bÃ n â†’ gá»i nhiá»u mÃ³n Äƒn (nhiá»u container) vÃ  cho chÃºng hoáº¡t Ä‘á»™ng cÃ¹ng nhau.

========================================================
DOCKER NETWORK
LÃ  cÆ¡ cháº¿ Ä‘á»ƒ cÃ¡c container giao tiáº¿p vá»›i nhau.

CÃ³ nhiá»u loáº¡i network trong Docker:

bridge (default cho Compose) â†’ container nÃ³i chuyá»‡n vá»›i nhau qua tÃªn service.
host â†’ container dÃ¹ng trá»±c tiáº¿p network cá»§a host.
overlay â†’ dÃ¹ng cho cluster (Swarm, Kubernetes).

ğŸ‘‰ VÃ­ dá»¥ vá»›i Compose á»Ÿ trÃªn:

app cÃ³ thá»ƒ káº¿t ná»‘i tá»›i db qua hostname db:5432 (vÃ¬ Compose tá»± táº¡o network).
Báº¡n khÃ´ng cáº§n nhá»› IP, chá»‰ cáº§n dÃ¹ng service name (db).

Khi báº¡n cháº¡y docker-compose up, Docker Compose sáº½:

Táº¡o má»™t network riÃªng cho project (thÆ°á»ng tÃªn dáº¡ng <project>_default).
Gáº¯n táº¥t cáº£ container (services) trong file docker-compose.yml vÃ o network Ä‘Ã³.
Cho phÃ©p container giao tiáº¿p vá»›i nhau báº±ng service name.

=================================================

PORT
Má»—i image cÃ³ 1 port riÃªng báº¡n cÃ³ thá»ƒ truy cáº­p vÃ o image Ä‘Ã³ báº±ng cÃ¡ch blingding port (káº¿t ná»‘i local vá»›i port network docker)

Docker ps -a Hiá»ƒn thá»‹ nhá»¯ng image Ä‘Ã£ cháº¡y trÆ°á»›c Ä‘Ã¢y 	 

NÆ I LÆ¯U TRá»® FILE IMAGES
TrÃªn Linux: image náº±m á»Ÿ /var/lib/docker.
TrÃªn Windows/macOS (Docker Desktop): image náº±m trong mÃ¡y áº£o ná»™i bá»™ cá»§a Docker, báº¡n khÃ´ng tháº¥y trá»±c tiáº¿p báº±ng Explorer, nhÆ°ng Docker CLI (docker images, docker inspect) quáº£n lÃ½ cho báº¡n.
================================================== 

Volume (nÆ¡i lÆ°u trá»¯ local)

Container nÃ³ khÃ´ng tá»± Ä‘á»™ng lÆ°u trá»¯ thÃ´ng tin. Khi táº¯t container Ä‘i thÃ¬ nÃ³ sáº½ máº¥t háº¿t. 
VÃ¬ váº­y cáº§n pháº£i cÃ³ volume Ä‘á»ƒ data container nÃ³ lÆ°u trá»¯ vÃ o Ä‘áº¥y.